{% extends "base.html" %}
{% load static %}

{% block title %}Atualizar Sistema{% endblock %}

{% block content %}
<div class="br-page">
    <div class="br-card">
        <div class="card-header">
            <h2 class="card-title">Atualizar Sistema</h2>
            <button id="btnAtualizarSistema" class="br-button primary" type="button">
                <i class="fas fa-sync"></i>
                Atualizar Sistema
            </button>
        </div>
        
        <div class="br-message" role="alert" style="display: none;">
            <div class="icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="content" id="messageContent"></div>
            <div class="close">
                <button class="br-button circle small" type="button" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('btnAtualizarSistema').addEventListener('click', function() {
    const btn = this;
    const message = document.querySelector('.br-message');
    const messageContent = document.getElementById('messageContent');
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';

    fetch('{% url "Atualizar_Transacoes:atualizar_sistema" %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            message.classList.add('success');
            messageContent.textContent = 'Sistema atualizado com sucesso!';
            message.style.display = 'flex';
            setTimeout(() => location.reload(), 1500);
        } else {
            throw new Error(data.message);
        }
    })
    .catch(error => {
        message.classList.add('danger');
        messageContent.textContent = 'Erro ao atualizar: ' + error.message;
        message.style.display = 'flex';
    })
    .finally(() => {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-sync"></i> Atualizar Sistema';
    });
});
</script>
{% endblock %}
